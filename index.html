<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Running a production Play! service in the cloud</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
            <section>
                <h3>Running a production Play! service in the cloud</h3>

                <p>

                    <small><a href="http://github.com/sclasen">Scott Clasen</a> / <a
                            href="http://twitter.com/scottclasen">@scottclasen</a> / Heroku API Team
                    </small>
                </p>
            </section>

            <section>
                <h3>Play! at Heroku</h3>

                <p>
                    We run several production services based on Play! / Scala, since the days of
                <pre><code data-trim>addSbtPlugin("play" % "sbt-plugin" % "2.0")</code></pre>
                </p>
            </section>

            <section>
                <h3>Play! at Heroku</h3>

                <p>
                    This talk summarizes some of the tooling and best practices we have developed.
                </p>

                <p class="fragment">
                    Many of them also codified in this template app <a href="https://github.com/sclasen/cloudplay">sclasen/cloudplay</a>
                </p>

                <p class="fragment">
                    Or this library <a href="https://github.com/sclasen/play-extras">sclasen/play-extras</a>
                </p>


            </section>

            <section>
                <h3>preface: <br/>building heroku on heroku</h3>
                <p>we try to the extent possible to build Heroku on Heroku</p>
                <p class="fragment">we call this ongoing effort: ephemeralization</p>
                <p class="fragment">all of our Play! services fall into this category</p>
            </section>

            <section>
                <h3>preface: the 12 factor app</h3>
                <p>this talk touches on several of the concepts described in <a href="http://12factor.net/">http://12factor.net/</a></p>
                <p class="fragment">In particular</p>
                <ul class="fragment">
                <li>III. Store config in the environment</li>
                <li>X. Keep development, staging, and production as similar as possible</li>
                <li>XI. Treat logs as event streams</li>
                </ul>
            </section>

            <section>
                <h3>preface: basic tools</h3>
                <p>we use some basic tooling whether an app is ephemeralized, or not</p>
                <p class="fragment">Procfile / .env</p>
                <p class="fragment"><a href="http://ddollar.github.io/foreman/">foreman</a> / <a href="https://github.com/ddollar/forego">forego</a>
            </section>

            <section>
                <h3>Procfile</h3>
                <pre><code data-trim>
web:           bin/cloudplay -Dapplication.global=Web
continuous:    bin/cloudplay -Dapplication.global=Continuous
                </code></pre>
                <pre><code data-trim>
$ forego start web
// starts the web process, capture stdout
$ forego start
// start web and continuous processes, capture stdout on both
                </code></pre>
            </section>
            <section>
                <h3>.env</h3>
                <pre><code data-trim>
FOO=foooo
BAR=barrr

                </code></pre>
                <pre><code data-trim>
$ echo "foo: $FOO bar: $BAR"
foo: bar:
$ forego run echo "foo: $FOO bar: $BAR"
foo: foooo bar: barrr
                </code></pre>
            </section>

            <section>
                <h3>on with it!</h3>
                <ul>
                    <li>Continuous Deployment</li>
                    <li>Functionality not fully provided by Play!</li>
                    <li>Visibility</li>
                </ul>
            </section>

            <section>
                <h3>Continuous Deployment</h3>
                <p>Pipelines!</p>
                <p><a href="https://devcenter.heroku.com/articles/labs-pipelines">https://devcenter.heroku.com/articles/labs-pipelines</a></p>
                <p>backed by a Play! service as a matter of fact.</p>
                <p>Pipelines + Jenkins + Github Heroku and Hipchat plugins</p>
            </section>

            <section>
                <h3>Continuous Deployment:<br/> app pipeline</h3>
                <p class="fragment">mostly focused on integration testing</p>
                <p class="fragment">standard dev -> staging -> prod setup</p>
                <p class="fragment">dev + staging have app config + test config in their env</p>
            </section>
            <section>
                <h3>Continuous Deployment: jenkins</h3>
                <p>4 jobs per service</p>
                <p>1: app-master-to-dev</p>
                <p class="fragment">triggered by a github webhook</p>
                <p class="fragment">heroku jenkins plugin: heroku push buildstep</p>
                <p class="fragment">build app and deploy to dev</p>
            </section>
            <section>
                <h3>Continuous Deployment: jenkins</h3>
                <p>4 jobs per service</p>
                <p>2: app-test-dev</p>
                <p class="fragment">run integration tests from jenkins, hitting dev</p>
                <p class="fragment">heroku config:pull -o -a app-dev</p>
                <p class="fragment">overwrites .env file locally</p>
                <p class="fragment">foreman run play test</p>
            </section>
            <section>
                <h3>Continuous Deployment: jenkins</h3>
                <p>4 jobs per service</p>
                <p>3: app-promote-dev-staging</p>
                <p class="fragment">heroku pipeline:promote -a app-dev</p>
                <p class="fragment">thats it!</p>
            </section>
            <section>
                <h3>Continuous Deployment: jenkins</h3>
                <p>4 jobs per service</p>
                <p>4: app-test-staging</p>
                <p>same pattern as dev</p>
                <p>run integration tests from jenkins, hitting staging</p>
                <p>heroku config:pull -o -a app-dev</p>
                <p>overwrites .env file locally</p>
                <p>foreman run play test</p>
            </section>
            <section>
                <h3>Production deploy</h3>
                <p>heroku pipeline:promote -a app-staging</p>
                <p>thats it!</p>
            </section>
            <section>

            </section>
            <section>
                <h3></h3>
                <p class="fragment"></p>
                <p class="fragment"></p>
                <p class="fragment"></p>
                <p class="fragment"></p>
                <p class="fragment"></p>
            </section>
            <!--

            Running heroku on heroku/ephemeralization

            preface:12 factor

            dev setup  Procfile + .env  foreman / forego

            Testing and Deployment

            Deployent pipelines

            Build Automation.  Standard dev/staging. apps have standard config + test config set in config vars.
            Jenkins on EC2. Github and Heroku Hipchat Plugins
            4 jobs per service. Focused on integration testing.
            master-to-dev  github webhook. checkout and heroku push to dev.
            test-dev  heroku config:pull -a app-dev && play test
            promote-dev-staging heroku pipeline:promote -a app-dev
            test-staging heroku config:pull -a app-staging && play-test
            prod deploy -> heroku pipeline:promote -a app-staging



            Functionality not fully provided by Play!
            Background/Batch jobs
            Evolutions and Migrations
            Credentials handling/Encryption



            Visibility
            Request-Ids/Auditing/Tracing
            Logs as event streams
            Visibility: Splunk, Librato
            Actor Based Logback Appender
            -->


				<section>
					<h1>THANK YOU!</h1>
					<h3>Questions?</h3>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
